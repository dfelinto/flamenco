| {% extends 'flamenco/layout.html' %}
| {% block bodyattrs %}{{ super() }} data-context='job'{% endblock %}
| {% block page_title %}Jobs - {{ project.name }}{% endblock %}
| {% block body %}
#col_main
	.col_header.item-list-header
		span(title='In the edit') {{ stats.nr_of_jobs }} jobs | {{ stats.total_frame_count }} frames
		a.item-project(href="{{url_for('projects.view', project_url=project.url)}}") {{ project.name }}

	.item-list.col-scrollable
		.table
			.table-head
				.table-row
					.table-cell.item-status
					.table-cell.item-thumbnail
						span.collapser.thumbnails(title="Collapse thumbnails") Thumbnail
					.table-cell.item-name
						span.collapser(title="Collapse name column") Name
					.table-cell.item-progress
						span.collapser(title="Collapse progress column") Progress
					.table-cell.item-priority
						span.collapser(title="Collapse priority column") Priority

			.table-body.has-thumbnails
				| {% for job in jobs %}
				.table-row(
					id="job-{{ job._id }}",
					class="status-{{ job.status }}")
					.table-cell.item-status
					.table-cell.item-thumbnail
						a(data-job-id="{{ job._id }}",
							href="{{ url_for('flamenco.jobs.perproject.view_job', project_url=project.url, job_id=job._id) }}",
							class="status-{{ job.status }} job-link")
							| {% if job._thumbnail %}
							img(src="{{ job._thumbnail }}",
								alt="Thumbnail",
								style='width: 110px; height: {{ job._thumbnail_height }}')
							| {% else %}
							img(src="{{ url_for('static_flamenco', filename='assets/img/placeholder.jpg') }}",
								alt="Thumbnail",
								style='width: 110px; height: 26px')
							| {% endif %}
					.table-cell.item-name
						a(data-job-id="{{ job._id }}",
							href="{{ url_for('flamenco.jobs.perproject.view_job', project_url=project.url, job_id=job._id) }}",
							class="job-link")
							span(class="job-name-{{ job._id }}") {{ job.name }}
					.table-cell.item-progress
						a(data-job-id="{{ job._id }}",
							href="{{ url_for('flamenco.jobs.perproject.view_job', project_url=project.url, job_id=job._id) }}")
							span(class="job-progress-{{ job._id }}") 99%
					.table-cell.item-priority
						a(data-job-id="{{ job._id }}",
							href="{{ url_for('flamenco.jobs.perproject.view_job', project_url=project.url, job_id=job._id) }}")
							span(class="job-priority-{{ job._id }}") {{ job.priority }}
				| {% endfor %}

.col-splitter

#col_right
	.col_header
		span.header_text
		#status-bar
	#item-details
		.item-details-empty
			| Select a Job
			| {{ open_job_id }}

| {% endblock %}
| {% block footer_scripts %}
script.
	{% if open_task_id %}
		$(function() { item_open('{{ open_task_id }}', 'task', false); });
	{% endif %}
	{% if open_job_id %}
		$(function() { item_open('{{ open_job_id }}', 'job', false); });
	{% endif %}

	var same_cells;

	/* Collapse columns by clicking on the title */
	$('.table-head .table-cell span.collapser').on('click', function(e){
		e.stopPropagation();

		/* We need to find every cell matching the same classes */
		same_cells = '.' + $(this).parent().attr('class').split(' ').join('.');
		$(same_cells).hide();
		/* Add the spacer which we later click to expand  */
		$('<div class="table-cell-spacer ' + $(this).text() + '" title="Expand ' + $(this).text() + '"></div>').insertAfter(same_cells);
	});

	$('body').on('click', '.table-cell-spacer', function(){

		/* We need to find every cell matching the same classes */
		same_cells = '.' + $(this).prev().attr('class').split(' ').join('.');
		$(same_cells).show();
		$(same_cells).next().remove();
	});

	$('.table-body .table-cell').mouseenter(function(){
		same_cells = '.' + $(this).attr('class').split(' ').join('.');
		$('.table-head ' + same_cells).addClass('highlight');
	}).mouseleave(function(){
		same_cells = '.' + $(this).attr('class').split(' ').join('.');
		$('.table-head ' + same_cells).removeClass('highlight');
	});

	$('.table-head .table-cell').mouseenter(function(){
		same_cells = '.' + $(this).attr('class').split(' ').join('.');
		$('.table-body ' + same_cells).addClass('highlight');
	}).mouseleave(function(){
		same_cells = '.' + $(this).attr('class').split(' ').join('.');
		$('.table-body ' + same_cells).removeClass('highlight');
	});

script(src="{{ url_for('static_flamenco', filename='assets/js/vendor/clipboard.min.js')}}")
script(src="{{ url_for('static_flamenco', filename='assets/js/vendor/jquery-resizable.min.js')}}")
script.
	$("#col_main").resizable({
		handleSelector: ".col-splitter",
		resizeHeight: false
	});

	$(window).on('load resize', function(){
		var window_height = $(window).height() - 50; // header is 50px
		$('#job-list').css({'height': window_height});
		$('#item-details').css({'height': window_height});
	});

| {% endblock footer_scripts %}
