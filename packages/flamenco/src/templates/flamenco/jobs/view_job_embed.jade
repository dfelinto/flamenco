.flamenco-box.job.with-status(class="status-{{ job.status }}")
	form#item_form(onsubmit="return job_save('{{job._id}}', '{{ url_for('flamenco.jobs.perproject.save', project_url=project['url'], job_id=job._id) }}')")
		input(type='hidden',name='_etag',value='{{ job._etag }}')
		| {% if 'PUT' in job.allowed_methods %}
		.input-group
			textarea#item-description.input-transparent(
				name="description",
				type="text",
				rows=1,
				placeholder='Description') {{ job.description | hide_none }}

		.input-group
			label(for="item-status") Status:
			select#item-status.input-transparent(
				name="status")
				| {% for status in ['failed', 'active'] %}
				| <option value="{{ status }}" {% if status == job.status %}selected{% endif %}>{{ status | undertitle }}</option>
				| {% endfor %}

		.input-group-separator

		.input-group

			button#item-save.btn.btn-default.btn-block(type='submit')
				i.pi-check
				| Save Job
		| {% else %}
		//- NOTE: read-only versions of the fields above.
		| {% if job.description %}
		p.item-description {{ job.description | hide_none }}
		| {% endif %}

		.table.item-properties
			.table-body
				.table-row.properties-status.js-help(
					data-url="{{ url_for('flamenco.help', project_url=project.url) }}")
					.table-cell Status
					.table-cell(class="status-{{ job.status }}")
						| {{ job.status | undertitle }}

		| {% endif %}

.flamenco-box
	.table.item-properties
		.table-body
			.table-row
				.table-cell Last Update
				.table-cell(title="{{ job._updated }}")
					span(role='button',
						data-toggle='collapse',
						data-target='#task-time-creation',
						aria-expanded='false',
						aria-controls='#task-time-creation')
						| {{ job._updated | pretty_date_time }}
					#task-time-creation.collapse
						| Created on {{ job._created | pretty_date_time }}
			.table-row
				.table-cell Job Type
				.table-cell(title="Job Type")
					| {{ job.job_type }}

#item-view-feed
	#tasks
	#comments-embed

	| {% if config.DEBUG %}
	.debug-info
		a.debug-info-toggle(role='button',
			data-toggle='collapse',
			href='#debug-content',
			aria-expanded='false',
			aria-controls='debug-content')
			i.pi-info
			| Debug Info
		#debug-content.collapse
			pre.
				{{ job.to_dict() | pprint }}
		| {% endif %}

script.

	$('.js-help').openModalUrl('Help', "{{ url_for('flamenco.help', project_url=project.url) }}");

	{% if 'PUT' in job.allowed_methods %}
		/* Resize textareas */
		var textAreaFields = $('#item-description, #item-notes');

		textAreaFields.each(function(){
			$(this)
				.autoResize()
				.blur();
		});

		$('#item-status').change(function(){
			$("#item-save").trigger( "click" );
		});
	{% endif %}

	loadTasks("{{url_for('flamenco.tasks.index', embed=1, job_id=job._id) | safe}}");
